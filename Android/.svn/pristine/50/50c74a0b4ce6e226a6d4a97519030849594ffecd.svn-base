package phone.gps.runnable;

import android.content.Context;
import android.location.Location;
import android.os.Handler;

import phone.gps.obj.Globals;
import phone.gps.obj.PositionInfo;
import phone.gps.preferences.Authentication;
import phone.gps.webservice.PositionInfoService;

/**
 * Created by marco on 3/9/16.
 */

public class LocationServiceRunnable implements Runnable {
    public static interface LocationServiceInterface{
        void onComplete();
        void onError(Exception ex);
    }

    private LocationServiceInterface locationServiceInterface;
    private Authentication auth;
    private Context ctx;

    public LocationServiceRunnable(LocationServiceInterface locationServiceInterface, Context ctx){
        this.locationServiceInterface=locationServiceInterface;
        auth=new Authentication(ctx);
        this.ctx=ctx;
    }

    @Override
    public void run() {
        try {
            Location location = Globals.getLocation(ctx); //get current location

            location = new Location("point A");
            location.setLatitude( 37.555 );
            location.setLongitude( 66.535 );

            if(auth.isLogged() && location!=null) {
                //update user location to server
                PositionInfoService positionInfoService=new PositionInfoService();
                positionInfoService.updateLocation(
                        new PositionInfo(
                                        0,
                                        location.getLatitude(),
                                        location.getLongitude(),
                                        location.getAccuracy()
                                        ),
                        auth.read().getToken(),
                        auth.read().getImei()
                );
            }

        }catch (Exception ex){
            locationServiceInterface.onError(ex);
        }

        locationServiceInterface.onComplete();
    }
}
